\subsection{Extensible Templates}\label{subsec:templates}

Parr has formalized and developed the StringTemplate \cite{st} language for code generation.
CML's extensible templates are implemented in StringTemplate.
The CML compiler uses StringTemplate for two purposes:

\begin{itemize}

\item \emph{File names and directory structure:}
each type of target generated by the CML compiler requires a different directory structure.
The CML compiler expects each \emph{constructor} to define a template file named ``files.stg''
(also known as \emph{files template}),
which will contain the path of all files to be generated.
The \emph{files template} may use information provided by the \emph{task}
(introduced in subsection \ref{subsec:overview})
in order to determine the file/directory names.
An example of a \emph{files template} is shown below:
\verbatimfont{\scriptsize}
\begin{verbatim}
model_files(task, model) ::= <<
pom_file|pom.xml
>>

concept_files(task, concept) ::= <<
concept_file|src/main/java/<task.packagePath>/<concept.name; format="pascal-case">.java
>>
\end{verbatim}

\item \emph{File content generation:}
each file listed under the \emph{files template} will have a corresponding \emph{content template}
that specifies how the file's content must be generated.
The \emph{content template} will receive as input one root-level element of the CML model,
which will provide information to generate the file's content.
The type of model element received as input by the \emph{content template} depends on
which function of the \emph{files template} has defined the file to be generated.
A typical \emph{content template} is shown below:
\verbatimfont{\scriptsize}
\begin{verbatim}
import "/design/poj.stg"

concept_file(task, concept) ::= <<
package <task.packageName>;

import java.util.*;

public <class(concept)>
>>
\end{verbatim}

\end{itemize}

On the \emph{files template} example,
two types of files are created by this \emph{constructor}:
one file for the CML module (named ``pom.xml'', and based on the ``pom\_file'' template);
and one for each concept found in the CML model
(with the file extension ``.java'', and based on the ``concept\_file'' template.)

On the \emph{content template} example, the ``concept\_file'' content template is displayed,
which can generate a \emph{Data Type Object} (DTO) class in Java.
The actual template that knows how to generate the class is imported from ``/design/poj.stg''.
