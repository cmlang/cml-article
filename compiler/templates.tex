\subsection{Extensible Templates}\label{subsec:templates}

Parr has formalized and developed the StringTemplate \cite{st} language for code generation. CML extensible templates are implemented in StringTemplate. The CML compiler uses StringTemplate for two purposes:

\begin{itemize}

\item \emph{File names and directory structure:}
each type of target generated by the CML compiler requires a different directory structure.
The CML compiler expects each target type to define a template file named ``files.stg'' (also known as \emph{files template}),
which will contain the path of all files to be generated.
The \emph{files template} may use information provided by the \emph{target specification} (introduced in subsection \ref{subsec:overview})
in order to determine the file/directory names.
An example of a \emph{files template} is shown below:
\verbatimfont{\scriptsize}
\begin{verbatim}
moduleFiles(target, module) ::= <<
maven:pom|pom.xml
>>

conceptFiles(target, concept) ::= <<
dto|src/main/java/<target.packagePath>/<concept.name>.java
>>
\end{verbatim}

\item \emph{File content generation:}
each file listed under the \emph{files template} will have a corresponding \emph{content template} that specifies how the file's content must be generated. The \emph{content template} will receive as input one root-level element of the CML model, which will provide information to generate the file's content. The type of model element received as input by the \emph{content template} depends on which function of the \emph{files template} has defined the file to be generated.
A typical \emph{content template} is shown below:
\verbatimfont{\scriptsize}
\begin{verbatim}
import "/lang/class.stg"

dto(target, concept) ::= <<
package <target.packageName>;

import java.util.*;

public <class(concept)>
>>
\end{verbatim}


\end{itemize}

On the \emph{files template} example,
two types of files are created for this target:
one file for the CML module (named ``pom.xml'', and based on the ``pom'' template); and one for each concept found in the CML model (with the file extension ``.java'', and based on the ``dto'' template.)

On the \emph{content template} example, the ``dto'' content template is displayed, which can generate a DTO class in Java. The actual template that knows how to generate the class is imported from ``/lang/class.stg''.
